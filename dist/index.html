<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ›¹å†²ç§°è±¡åŸç†æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }
        
        body {
            background-color: #f0f8ff;
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        header {
            text-align: center;
            margin-bottom: 15px;
            padding: 12px;
            background: linear-gradient(135deg, #4a90e2, #63b3ed);
            border-radius: 10px;
            color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 5px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.4;
        }
        
        .container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            height: calc(100vh - 150px);
        }
        
        /* æ²³æµåŒºåŸŸæ ·å¼ */
        .river-area {
            flex: 3;
            background-color: #fff;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .river-title {
            font-size: 1.5rem;
            color: #1e5ea3;
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 2px solid #4a90e2;
        }
        
        .river-container {
            flex: 1;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.08);
            background-color: #e3f2fd;
        }
        
        /* ç™½è‰²ä¸ŠåŠéƒ¨åˆ† - å¯æ˜¾ç¤ºæ°´é¢ä¸Šæ–¹ */
        .water-above {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%; /* åˆå§‹æ°´é¢åœ¨50%å¤„ */
            background-color: white;
            z-index: 1;
            transition: height 1.5s ease;
        }
        
        /* æ°´é¢ - åˆå§‹åœ¨50%ä½ç½® */
        .water-surface {
            position: absolute;
            top: 50%; /* åˆå§‹æ°´é¢åœ¨50%å¤„ */
            left: 0;
            width: 100%;
            height: 50%; /* æ°´å æ®ä¸‹åŠéƒ¨åˆ† */
            background: linear-gradient(to bottom, #1e88e5, #4fc3f7, #1e88e5);
            z-index: 2;
            transition: top 1.5s ease, height 1.5s ease;
        }
        
        /* åˆå§‹æ°´é¢çº¿æ ‡è®° */
        .initial-water-line {
            position: absolute;
            top: 50%; /* åˆå§‹æ°´é¢çº¿ */
            left: 0;
            width: 100%;
            height: 2px;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 3;
            border-top: 2px dashed rgba(0, 0, 0, 0.5);
        }
        
        .initial-water-line::before {
            content: 'åˆå§‹æ°´é¢';
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: #333;
            font-weight: bold;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 17;
        }
        
        /* æ²³æµæ³¢çº¹æ•ˆæœ */
        .wave {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z" opacity=".25" fill="%230097e6"/><path d="M0,0V15.81C13,36.92,27.64,56.86,47.69,72.05,99.41,111.27,165,111,224.58,91.58c31.15-10.15,60.09-26.07,89.67-39.8,40.92-19,84.73-46,130.83-49.67,36.26-2.85,70.9,9.42,98.6,31.56,31.77,25.39,62.32,62,103.63,73,40.44,10.79,81.35-6.69,119.13-24.28s75.16-39,116.92-43.05c59.73-5.85,113.28,22.88,168.9,38.84,30.2,8.66,59,6.17,87.09-7.5,22.43-10.89,48-26.93,60.65-49.24V0Z" opacity=".5" fill="%230097e6"/><path d="M0,0V5.63C149.93,59,314.09,71.32,475.83,42.57c43-7.64,84.23-20.12,127.61-26.46,59-8.63,112.48,12.24,165.56,35.4C827.93,77.22,886,95.24,951.2,90c86.53-7,172.46-45.71,248.8-84.81V0Z" fill="%230097e6"/></svg>');
            background-size: 1200px 100%;
            animation: wave 12s linear infinite;
            opacity: 0.6;
        }
        
        .wave:nth-child(2) {
            animation-duration: 16s;
            opacity: 0.4;
        }
        
        .wave:nth-child(3) {
            animation-duration: 20s;
            opacity: 0.2;
        }
        
        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1200px; }
        }
        
        /* èˆ¹æ ·å¼ - åˆå§‹èˆ¹åº•ä¸æ°´é¢å¹³é½ */
        .boat-container {
            position: absolute;
            top: 30%; /* èˆ¹é¡¶ä½ç½®ï¼Œèˆ¹é«˜20%ï¼Œèˆ¹åº•åœ¨50%å¤„ä¸æ°´é¢å¹³é½ */
            left: 50%;
            transform: translateX(-50%);
            transition: top 1.5s ease;
            z-index: 10;
            width: 300px;
            height: 120px;
        }
        
        .boat-img {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 10px 15px rgba(0, 0, 0, 0.3));
            position: relative;
            z-index: 15;
            object-fit: contain;
        }
        
        /* èˆ¹èº«ä¸Šçš„æ°´ä½çº¿æ ‡è®° */
        .boat-water-mark {
            position: absolute;
            left: 5%;
            width: 90%;
            height: 3px;
            background-color: red;
            display: none;
            z-index: 200;
            box-shadow: 0 0 5px rgba(255, 0, 0, 0.7);
        }
        
        .boat-water-mark::before {
            content: 'æ°´ä½çº¿';
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: red;
            font-weight: bold;
            background-color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 17;
        }
        
        /* èˆ¹ä½“å®¹å™¨ï¼Œç”¨äºæ”¾ç½®å¤§è±¡å’ŒçŸ³å¤´ */
        .boat-content {
            position: absolute;
            top: 8%;
            left: 10%;
            width: 80%;
            height: 60%;
            z-index: 16;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        /* å¤§è±¡åœ¨èˆ¹ä¸Šçš„æ ·å¼ */
        .elephant-on-boat {
            position: absolute;
            width: 100px;
            height: auto;
            z-index: 13;
            filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
            display: none;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            pointer-events: none; /* é˜²æ­¢å¹²æ‰°æ‹–æ”¾ */
        }
        
        /* çŸ³å¤´åœ¨èˆ¹ä¸Šçš„æ ·å¼ - å †å åœ¨èˆ¹å†… */
        .stones-on-boat {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px; /* é™åˆ¶çŸ³å¤´å †å åŒºåŸŸ */
            height: 70px; /* é™åˆ¶çŸ³å¤´å †å åŒºåŸŸ */
            z-index: 12;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none; /* é˜²æ­¢å¹²æ‰°ç‚¹å‡» */
        }
        
        .stone-on-boat {
            position: absolute;
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: transform 0.3s;
            z-index: 14;
            pointer-events: auto; /* å…è®¸ç‚¹å‡»ç§»é™¤ */
            transform-origin: center center;
        }
        
        .stone-on-boat:hover {
            transform: scale(1.1);
        }
        
        /* æ§åˆ¶é¢æ¿æ ·å¼ */
        .control-area {
            flex: 1;
            background-color: #fff;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);
            min-width: 300px;
            display: flex;
            flex-direction: column;
        }
        
        .control-title {
            font-size: 1.5rem;
            color: #1e5ea3;
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 2px solid #4a90e2;
        }
        
        .elephant-container {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            background-color: #f9f9f9;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
        }
        
        .elephant-img {
            width: 150px;
            height: auto;
            cursor: grab;
            transition: all 0.3s;
            margin: 0 auto;
            display: block;
            filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.2));
            user-select: none;
        }
        
        .elephant-img.dragging {
            opacity: 0.7;
            transform: scale(0.95);
            cursor: grabbing;
        }
        
        /* æŒ‰é’®å®¹å™¨ */
        .button-row {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            margin: 15px 0;
        }
        
        .action-button {
            flex: 1;
            padding: 10px 6px;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            white-space: nowrap;
        }
        
        .action-button:hover {
            background: linear-gradient(135deg, #66BB6A, #388E3C);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        
        .action-button:active {
            transform: translateY(1px);
        }
        
        .action-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .reset-button {
            background: linear-gradient(135deg, #f44336, #c62828);
        }
        
        .reset-button:hover {
            background: linear-gradient(135deg, #ef5350, #d32f2f);
        }
        
        .remove-elephant-button {
            background: linear-gradient(135deg, #FF9800, #EF6C00);
        }
        
        .remove-elephant-button:hover {
            background: linear-gradient(135deg, #FFB74D, #F57C00);
        }
        
        .counter {
            display: flex;
            justify-content: space-around;
            margin: 10px 0 15px 0;
            font-size: 1rem;
            color: #555;
            background-color: #f5f5f5;
            padding: 8px 12px;
            border-radius: 6px;
        }
        
        .counter-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e5ea3;
        }
        
        .stones-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 5px;
            border-radius: 8px;
        }
        
        .stones {
            flex-grow: 1;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 15px;
            justify-items: center;
            align-items: center;
        }
        
        .stone {
            width: 80px;
            height: 80px;
            cursor: grab;
            transition: all 0.3s;
            user-select: none;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }
        
        .stone.dragging {
            opacity: 0.7;
            transform: scale(0.9);
            cursor: grabbing;
        }
        
        /* åˆ»åº¦å°º */
        .scale-container {
            position: absolute;
            left: 20px;
            top: 0;
            height: 100%;
            width: 40px;
            z-index: 5;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #ccc;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }
        
        .scale-mark {
            width: 100%;
            text-align: center;
            font-size: 11px;
            color: #333;
            position: relative;
            height: 10%;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid #ddd;
        }
        
        .scale-mark::after {
            content: '';
            position: absolute;
            right: 0;
            width: 8px;
            height: 1px;
            background: #666;
        }
        
        .scale-center {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background: #666;
            z-index: 6;
        }
        
        .scale-center::before {
            content: 'åˆå§‹æ°´é¢';
            position: absolute;
            left: -45px;
            top: -10px;
            background: #666;
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 11px;
        }
        
        /* æ ‡è®°æ¨¡å¼æç¤º */
        .marking-hint {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 8px 15px;
            border-radius: 20px;
            color: #e53935;
            font-weight: bold;
            z-index: 20;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            display: none;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1100px) {
            .container {
                flex-direction: column;
                height: auto;
            }
            
            .control-area {
                min-width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.7rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
            }
            
            .river-title, .control-title {
                font-size: 1.3rem;
            }
            
            .elephant-img {
                width: 130px;
            }
            
            .stone {
                width: 65px;
                height: 65px;
            }
            
            .button-row {
                flex-direction: column;
                gap: 6px;
            }
            
            .boat-container {
                width: 250px;
                height: 100px;
            }
            
            .stones-on-boat {
                width: 100px;
                height: 60px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>æ›¹å†²ç§°è±¡åŸç†æ¼”ç¤º</h1>
        <p class="subtitle">é€šè¿‡äº’åŠ¨åŠ¨ç”»ç†è§£ç­‰é‡æ›¿æ¢åŸç† - æ‹–åŠ¨å¤§è±¡å’ŒçŸ³å¤´åˆ°èˆ¹ä¸Šè¿›è¡Œå®éªŒ</p>
    </header>
    
    <div class="container">
        <!-- å·¦ä¾§æ²³æµåŒºåŸŸ -->
        <div class="river-area">
            <h2 class="river-title">æ²³æµä¸èˆ¹</h2>
            
            <div class="river-container" id="river-container">
                <!-- åˆ»åº¦å°º -->
                <div class="scale-container">
                    <div class="scale-mark">100%</div>
                    <div class="scale-mark">90%</div>
                    <div class="scale-mark">80%</div>
                    <div class="scale-mark">70%</div>
                    <div class="scale-mark">60%</div>
                    <div class="scale-mark">50%</div>
                    <div class="scale-mark">40%</div>
                    <div class="scale-mark">30%</div>
                    <div class="scale-mark">20%</div>
                    <div class="scale-mark">10%</div>
                    <div class="scale-center"></div>
                </div>
                
                <!-- æ ‡è®°æ¨¡å¼æç¤º -->
                <div class="marking-hint" id="marking-hint">ç‚¹å‡»èˆ¹èº«æ ‡è®°æ°´ä½çº¿</div>
                
                <!-- æ°´é¢ä¸Šæ–¹éƒ¨åˆ† -->
                <div class="water-above" id="water-above"></div>
                
                <!-- åˆå§‹æ°´é¢çº¿ -->
                <div class="initial-water-line"></div>
                
                <!-- è“è‰²æ²³æ°´éƒ¨åˆ† -->
                <div class="water-surface" id="water-surface">
                    <!-- æ²³æµæ³¢çº¹ -->
                    <div class="wave"></div>
                    <div class="wave"></div>
                    <div class="wave"></div>
                </div>
                
                <!-- èˆ¹å®¹å™¨ -->
                <div class="boat-container" id="boat-container">
                    <!-- èˆ¹èº«ä¸Šçš„æ°´ä½çº¿æ ‡è®° -->
                    <div class="boat-water-mark" id="boat-water-mark"></div>
                    
                    <!-- èˆ¹å†…å®¹åŒºåŸŸï¼Œç”¨äºæ”¾ç½®å¤§è±¡å’ŒçŸ³å¤´ -->
                    <div class="boat-content">
                        <!-- å¤§è±¡ï¼ˆå½“æ”¾åœ¨èˆ¹ä¸Šæ—¶æ˜¾ç¤ºåœ¨è¿™é‡Œï¼‰ -->
                        <img src="elephant.png" alt="å¤§è±¡" class="elephant-on-boat" id="elephant-on-boat">
                        
                        <!-- çŸ³å¤´ï¼ˆå½“æ”¾åœ¨èˆ¹ä¸Šæ—¶æ˜¾ç¤ºåœ¨è¿™é‡Œï¼‰ -->
                        <div class="stones-on-boat" id="stones-on-boat"></div>
                    </div>
                    
                    <!-- èˆ¹å›¾ç‰‡ -->
                    <img src="boat.png" alt="èˆ¹" class="boat-img" id="boat-img">
                </div>
            </div>
        </div>
        
        <!-- å³ä¾§æ§åˆ¶é¢æ¿ -->
        <div class="control-area">
            <h2 class="control-title">æ§åˆ¶é¢æ¿</h2>
            
            <div class="elephant-container">
                <img src="elephant.png" alt="å¤§è±¡" class="elephant-img" id="elephant-img" draggable="true">
                
                <!-- ä¸‰ä¸ªæŒ‰é’®å¹¶æ’ -->
                <div class="button-row">
                    <button class="action-button" id="mark-button" disabled>æ ‡è®°æ°´ä½çº¿</button>
                    <button class="action-button remove-elephant-button" id="remove-elephant-button" disabled>ç§»é™¤å¤§è±¡</button>
                    <button class="action-button reset-button" id="reset-button">é‡ç½®å®éªŒ</button>
                </div>
            </div>
            
            <div class="counter">
                <div class="counter-value" id="stone-count">0/6</div>
                <div class="counter-value" id="sink-depth">ä¸‹æ²‰:0cm</div>
            </div>
            
            <div class="stones-container">
                <div class="stones" id="stones">
                    <!-- çŸ³å¤´å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€å˜é‡
        let elephantOnBoat = false;
        let waterMarkAdded = false;
        let stoneCount = 0;
        const totalStones = 6; // æ€»å…±6å—çŸ³å¤´
        let stonesOnBoat = [];
        let speechEnabled = true;
        let isMarkingMode = false; // æ˜¯å¦å¤„äºæ ‡è®°æ¨¡å¼
        let successAnnounced = false; // æ˜¯å¦å·²ç»å®£å¸ƒå®éªŒæˆåŠŸ
        
        // å…³é”®å‚æ•°ï¼ˆæ‰€æœ‰è®¡ç®—ä»¥ç™¾åˆ†æ¯”ä¸ºå•ä½ï¼‰
        const initialWaterLevel = 50; // åˆå§‹æ°´é¢ä½ç½®ï¼ˆ%ï¼‰
        const initialBoatTop = 30; // èˆ¹é¡¶åˆå§‹ä½ç½®ï¼ˆ%ï¼‰ï¼Œèˆ¹é«˜20%ï¼Œèˆ¹åº•åœ¨50%å¤„ä¸æ°´é¢å¹³é½
        const boatHeight = 20; // èˆ¹çš„é«˜åº¦ï¼ˆ%ï¼‰
        
        // ä¸‹æ²‰å‚æ•°ï¼ˆæ¨¡æ‹Ÿ5cmä¸‹æ²‰ï¼‰
        const maxSinkAmount = 5; // æœ€å¤§ä¸‹æ²‰5%ï¼ˆæ¨¡æ‹Ÿ5cmï¼‰
        const elephantSinkAmount = maxSinkAmount; // å¤§è±¡ä½¿èˆ¹ä¸‹æ²‰5%
        const stoneSinkAmount = maxSinkAmount / totalStones; // æ¯å—çŸ³å¤´ä½¿èˆ¹ä¸‹æ²‰çš„å¹…åº¦
        
        // å½“å‰çŠ¶æ€
        let currentWaterLevel = initialWaterLevel; // å½“å‰æ°´é¢ä½ç½®
        let currentBoatTop = initialBoatTop; // å½“å‰èˆ¹é¡¶ä½ç½®
        let currentSinkAmount = 0; // å½“å‰ä¸‹æ²‰é‡
        let waterMarkPosition = 0; // æ°´ä½çº¿åœ¨èˆ¹ä¸Šçš„ä½ç½®ï¼ˆä»èˆ¹é¡¶ç®—èµ·çš„ç™¾åˆ†æ¯”ï¼‰
        
        // DOMå…ƒç´ 
        const elephantImg = document.getElementById('elephant-img');
        const elephantOnBoatImg = document.getElementById('elephant-on-boat');
        const boatContainer = document.getElementById('boat-container');
        const boatWaterMark = document.getElementById('boat-water-mark');
        const waterSurface = document.getElementById('water-surface');
        const waterAbove = document.getElementById('water-above');
        const markButton = document.getElementById('mark-button');
        const markingHint = document.getElementById('marking-hint');
        const removeElephantButton = document.getElementById('remove-elephant-button');
        const resetButton = document.getElementById('reset-button');
        const riverContainer = document.getElementById('river-container');
        const stoneCountElement = document.getElementById('stone-count');
        const sinkDepthElement = document.getElementById('sink-depth');
        const stonesContainer = document.getElementById('stones');
        const stonesOnBoatContainer = document.getElementById('stones-on-boat');
        
        // è¯­éŸ³æç¤ºå‡½æ•°
        function speak(text) {
            if (!speechEnabled) return;
            
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-CN';
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                
                window.speechSynthesis.speak(utterance);
            }
        }
        
        // åˆå§‹åŒ– - åˆ›å»º6å—çŸ³å¤´
        function createStones() {
            for (let i = 0; i < totalStones; i++) {
                const stone = document.createElement('img');
                stone.className = 'stone';
                stone.draggable = true;
                
                // äº¤æ›¿ä½¿ç”¨ä¸¤ç§çŸ³å¤´å›¾ç‰‡
                if (i % 2 === 0) {
                    stone.src = 'stone1.png';
                    stone.alt = 'çŸ³å¤´1';
                } else {
                    stone.src = 'stone2.png';
                    stone.alt = 'çŸ³å¤´2';
                }
                
                stone.dataset.id = `stone-${i}`;
                stone.dataset.type = i % 2 === 0 ? 'stone1' : 'stone2';
                stonesContainer.appendChild(stone);
                
                addDragEvents(stone, 'stone');
            }
        }
        
        // æ·»åŠ æ‹–åŠ¨äº‹ä»¶
        function addDragEvents(element, type) {
            element.addEventListener('dragstart', function(e) {
                this.classList.add('dragging');
                e.dataTransfer.setData('text/plain', type);
                e.dataTransfer.setData('id', this.dataset.id || '');
            });
            
            element.addEventListener('dragend', function() {
                this.classList.remove('dragging');
            });
        }
        
        // æ²³æµåŒºåŸŸçš„æ‹–æ”¾äº‹ä»¶
        riverContainer.addEventListener('dragover', function(e) {
            e.preventDefault();
        });
        
        riverContainer.addEventListener('drop', function(e) {
            e.preventDefault();
            const type = e.dataTransfer.getData('text/plain');
            const id = e.dataTransfer.getData('id');
            
            if (type === 'elephant') {
                if (!elephantOnBoat) {
                    putElephantOnBoat();
                }
            } else if (type === 'stone') {
                putStoneOnBoat(id);
            }
        });
        
        // å°†å¤§è±¡æ”¾åˆ°èˆ¹ä¸Š
        function putElephantOnBoat() {
            // éšè—å³è¾¹çš„å¤§è±¡
            elephantImg.style.opacity = '0.3';
            elephantImg.style.cursor = 'default';
            
            // æ˜¾ç¤ºèˆ¹ä¸Šçš„å¤§è±¡
            elephantOnBoatImg.style.display = 'block';
            elephantOnBoat = true;
            
            // èˆ¹ä¸‹æ²‰5cmï¼Œæ°´é¢ä¸Šå‡5cm
            currentSinkAmount = elephantSinkAmount;
            updateBoatAndWater();
            
            speak('å¤§è±¡ä¸Šèˆ¹');
            
            // å¯ç”¨æ ‡è®°æŒ‰é’®å’Œç§»é™¤å¤§è±¡æŒ‰é’®
            markButton.disabled = false;
            removeElephantButton.disabled = false;
            
            updateCounters();
        }
        
        // å°†çŸ³å¤´æ”¾åˆ°èˆ¹ä¸Š - å †å åœ¨èˆ¹å†…
        function putStoneOnBoat(stoneId) {
            if (!waterMarkAdded) {
                speak('è¯·å…ˆæ ‡è®°æ°´ä½çº¿');
                return;
            }
            
            if (stoneCount >= totalStones) {
                speak('çŸ³å¤´å·²æ”¾æ»¡');
                return;
            }
            
            const stoneElement = document.querySelector(`[data-id="${stoneId}"]`);
            if (!stoneElement) return;
            
            // å¦‚æœçŸ³å¤´å·²ç»åœ¨èˆ¹ä¸Šï¼Œåˆ™ä¸å†æ·»åŠ 
            if (stonesOnBoat.includes(stoneId)) return;
            
            // éšè—åŸå§‹çŸ³å¤´
            stoneElement.style.opacity = '0.3';
            stoneElement.style.cursor = 'default';
            
            // åˆ›å»ºèˆ¹ä¸Šçš„çŸ³å¤´å‰¯æœ¬
            const stoneOnBoat = document.createElement('img');
            stoneOnBoat.className = 'stone-on-boat';
            stoneOnBoat.dataset.id = `stone-on-boat-${stoneId}`;
            stoneOnBoat.dataset.originalId = stoneId;
            
            if (stoneElement.dataset.type === 'stone1') {
                stoneOnBoat.src = 'stone1.png';
                stoneOnBoat.alt = 'çŸ³å¤´1';
            } else {
                stoneOnBoat.src = 'stone2.png';
                stoneOnBoat.alt = 'çŸ³å¤´2';
            }
            
            // è®¡ç®—çŸ³å¤´ä½ç½® - å †å åœ¨èˆ¹ä¸­å¿ƒ
            // å †å æ•ˆæœï¼šæ¯å—çŸ³å¤´ç¨å¾®åç§»ä¸€ç‚¹ä½ç½®
            const centerX = 60; // èˆ¹ä¸­å¿ƒçš„xä½ç½®ï¼ˆ50%ï¼‰
            const centerY = 10; // èˆ¹ä¸­å¿ƒçš„yä½ç½®ï¼ˆ50%ï¼‰
            
            // éšæœºåç§»ï¼Œæ¨¡æ‹Ÿå †å æ•ˆæœ
            const offsetX = (Math.random() - 0.5) * 20; // -10åˆ°+10ä¹‹é—´çš„éšæœºåç§»
            const offsetY = (Math.random() - 0.5) * 0; // -7.5åˆ°+7.5ä¹‹é—´çš„éšæœºåç§»
            
            // è®¾ç½®çŸ³å¤´ä½ç½®
            stoneOnBoat.style.left = `${centerX + offsetX}%`;
            stoneOnBoat.style.top = `${centerY + offsetY}%`;
            
            // è®¾ç½®z-indexï¼Œåé¢çš„çŸ³å¤´åœ¨ä¸Šé¢
            stoneOnBoat.style.zIndex = 100 + stoneCount;
            
            stonesOnBoatContainer.appendChild(stoneOnBoat);
            stonesOnBoat.push(stoneId);
            stoneCount++;
            
            // è®¡ç®—æ–°çš„ä¸‹æ²‰é‡
            currentSinkAmount = stoneCount * stoneSinkAmount;
            
            updateBoatAndWater();
            
            // æ›´æ–°çŠ¶æ€å’Œè¯­éŸ³æç¤º
            updateStatus();
            updateCounters();
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ä»èˆ¹ä¸Šç§»é™¤çŸ³å¤´
            stoneOnBoat.addEventListener('click', function(e) {
                e.stopPropagation(); // é˜²æ­¢äº‹ä»¶å†’æ³¡
                removeStoneFromBoat(stoneId, stoneOnBoat);
            });
        }
        
        // ä»èˆ¹ä¸Šç§»é™¤çŸ³å¤´
        function removeStoneFromBoat(stoneId, stoneElement) {
            // é‡ç½®æˆåŠŸçŠ¶æ€
            successAnnounced = false;
            
            // æ˜¾ç¤ºåŸå§‹çŸ³å¤´
            const originalStone = document.querySelector(`[data-id="${stoneId}"]`);
            if (originalStone) {
                originalStone.style.opacity = '1';
                originalStone.style.cursor = 'grab';
            }
            
            // ä»èˆ¹ä¸Šç§»é™¤çŸ³å¤´
            stoneElement.remove();
            
            // ä»æ•°ç»„ä¸­ç§»é™¤
            const index = stonesOnBoat.indexOf(stoneId);
            if (index > -1) {
                stonesOnBoat.splice(index, 1);
            }
            
            stoneCount--;
            
            // è®¡ç®—æ–°çš„ä¸‹æ²‰é‡
            currentSinkAmount = stoneCount * stoneSinkAmount;
            
            updateBoatAndWater();
            
            updateStatus();
            updateCounters();
        }
        
        // æ›´æ–°èˆ¹å’Œæ°´é¢çš„ä½ç½®
        function updateBoatAndWater() {
            // è®¡ç®—èˆ¹çš„æ–°ä½ç½®
            currentBoatTop = initialBoatTop + currentSinkAmount;
            
            // è®¡ç®—æ°´é¢çš„æ–°ä½ç½®ï¼ˆèˆ¹ä¸‹æ²‰æ—¶ï¼Œæ°´é¢ä¼šä¸Šå‡ç›¸åŒçš„é‡ï¼‰
            currentWaterLevel = initialWaterLevel - currentSinkAmount;
            
            // æ›´æ–°èˆ¹çš„ä½ç½®
            boatContainer.style.top = `${currentBoatTop}%`;
            
            // æ›´æ–°æ°´é¢çš„ä½ç½®å’Œé«˜åº¦
            waterSurface.style.top = `${currentWaterLevel}%`;
            waterSurface.style.height = `${100 - currentWaterLevel}%`;
            
            // æ›´æ–°æ°´é¢ä¸Šæ–¹çš„é«˜åº¦
            waterAbove.style.height = `${currentWaterLevel}%`;
            
            // å¦‚æœæ°´ä½çº¿å·²æ ‡è®°ï¼Œæ›´æ–°æ°´ä½çº¿ä½ç½®
            if (waterMarkAdded) {
                updateWaterMarkPosition();
            }
            
            updateCounters();
            
            // æ£€æŸ¥æ°´ä½çº¿æ˜¯å¦ä¸æ°´é¢é‡åˆ
            checkWaterLineAlignment();
        }
        
        // æ›´æ–°æ°´ä½çº¿ä½ç½®
        function updateWaterMarkPosition() {
            if (!waterMarkAdded) return;
            
            // æ°´ä½çº¿åœ¨èˆ¹ä¸Šçš„ä½ç½®æ˜¯å›ºå®šçš„ï¼ˆæ ‡è®°æ—¶çš„ä½ç½®ï¼‰
            boatWaterMark.style.top = `${waterMarkPosition}%`;
        }
        
        // æ£€æŸ¥æ°´ä½çº¿æ˜¯å¦ä¸æ°´é¢é‡åˆ
        function checkWaterLineAlignment() {
            if (!waterMarkAdded) return;
            
            // è·å–æ°´ä½çº¿åœ¨é¡µé¢ä¸­çš„ç»å¯¹ä½ç½®
            const boatTop = parseFloat(boatContainer.style.top);
            const waterMarkTopInPage = boatTop + waterMarkPosition;
            
            // è·å–å½“å‰æ°´é¢ä½ç½®
            const waterTop = parseFloat(waterSurface.style.top);
            
            // å¦‚æœæ°´ä½çº¿ä½ç½®æ¥è¿‘æ°´é¢ä½ç½®ï¼Œè¯´æ˜é‡åˆ
            const difference = Math.abs(waterMarkTopInPage - waterTop);
            
            if (difference < 0.5 && stoneCount === totalStones && !successAnnounced) {
                // æ”¾ç½®äº†6å—çŸ³å¤´ï¼Œæ°´ä½çº¿ä¸æ ‡è®°çº¿é‡åˆï¼Œè¯´æ˜6å—çŸ³å¤´çš„é‡é‡ç­‰äºå¤§è±¡çš„é‡é‡
                speak('æ”¾ç½®äº†6å—çŸ³å¤´ï¼Œæ°´ä½çº¿ä¸æ ‡è®°çº¿é‡åˆï¼Œè¯´æ˜6å—çŸ³å¤´çš„é‡é‡ç­‰äºå¤§è±¡çš„é‡é‡ã€‚å®éªŒæˆåŠŸï¼');
                successAnnounced = true;
            }
        }
        
        // å¼€å§‹æ ‡è®°æ°´ä½çº¿
        function startMarkingWaterLevel() {
            if (!elephantOnBoat) return;
            
            isMarkingMode = true;
            markingHint.style.display = 'block';
            boatContainer.style.cursor = 'crosshair';
            
            speak('ç‚¹å‡»èˆ¹èº«æ ‡è®°æ°´ä½çº¿');
            
            markButton.disabled = true;
            markButton.textContent = 'æ­£åœ¨æ ‡è®°...';
        }
        
        // èˆ¹èº«ç‚¹å‡»äº‹ä»¶ - ç”¨äºæ ‡è®°æ°´ä½çº¿
        boatContainer.addEventListener('click', function(e) {
            if (!isMarkingMode) return;
            
            // é˜²æ­¢ç‚¹å‡»çŸ³å¤´æ—¶è§¦å‘æ ‡è®°
            if (e.target.classList.contains('stone-on-boat')) {
                return;
            }
            
            // è·å–ç‚¹å‡»ä½ç½®åœ¨èˆ¹èº«ä¸Šçš„ç›¸å¯¹ä½ç½®
            const rect = this.getBoundingClientRect();
            const clickY = e.clientY - rect.top; // ç‚¹å‡»ä½ç½®è·ç¦»èˆ¹é¡¶çš„è·ç¦»
            const relativePosition = (clickY / rect.height) * 100; // è½¬æ¢ä¸ºç™¾åˆ†æ¯”
            
            // ç¡®ä¿æ°´ä½çº¿åœ¨èˆ¹èº«ä¸Šï¼ˆ10%åˆ°90%ä¹‹é—´ï¼‰
            if (relativePosition < 10 || relativePosition > 90) {
                speak('è¯·ç‚¹å‡»èˆ¹èº«ä¸­é—´åŒºåŸŸæ ‡è®°');
                return;
            }
            
            // æ ‡è®°æ°´ä½çº¿
            waterMarkPosition = relativePosition;
            boatWaterMark.style.top = `${waterMarkPosition}%`;
            boatWaterMark.style.display = 'block';
            waterMarkAdded = true;
            
            // é€€å‡ºæ ‡è®°æ¨¡å¼
            isMarkingMode = false;
            markingHint.style.display = 'none';
            boatContainer.style.cursor = 'default';
            
            markButton.textContent = 'æ°´ä½çº¿å·²æ ‡è®°';
            
            speak('æ°´ä½çº¿å·²æ ‡è®°');
        });
        
        // ç§»é™¤å¤§è±¡
        function removeElephantFromBoat() {
            if (!elephantOnBoat) return;
            
            // æ˜¾ç¤ºå³è¾¹çš„å¤§è±¡
            elephantImg.style.opacity = '1';
            elephantImg.style.cursor = 'grab';
            
            // éšè—èˆ¹ä¸Šçš„å¤§è±¡
            elephantOnBoatImg.style.display = 'none';
            elephantOnBoat = false;
            
            // èˆ¹å›åˆ°åˆå§‹ä½ç½®ï¼Œä½†æ°´ä½çº¿ä¿ç•™
            currentSinkAmount = 0;
            updateBoatAndWater();
            
            speak('å¤§è±¡ç§»é™¤');
            
            removeElephantButton.disabled = true;
            
            updateCounters();
        }
        
        // æ›´æ–°çŠ¶æ€
        function updateStatus() {
            // å½“6å—çŸ³å¤´å…¨éƒ¨æ”¾ä¸Šèˆ¹æ—¶æ£€æŸ¥æ˜¯å¦ä¸å¤§è±¡ä¸‹æ²‰ç›¸åŒ
            if (stoneCount === totalStones) {
                // æ£€æŸ¥6å—çŸ³å¤´æ˜¯å¦ä¸å¤§è±¡ä¸‹æ²‰ç›¸åŒ
                const expectedSinkAmount = maxSinkAmount;
                
                if (Math.abs(currentSinkAmount - expectedSinkAmount) < 0.5) {
                    // è¿™é‡Œä¸æç¤ºï¼Œåªåœ¨checkWaterLineAlignmentä¸­æç¤º
                }
            }
        }
        
        // æ›´æ–°è®¡æ•°å™¨æ˜¾ç¤º
        function updateCounters() {
            stoneCountElement.textContent = `${stoneCount}/${totalStones}`;
            
            // è®¡ç®—ä¸‹æ²‰æ·±åº¦ï¼ˆæ¨¡æ‹Ÿå˜ç±³ï¼‰
            const sinkDepthInCm = Math.round(currentSinkAmount);
            sinkDepthElement.textContent = `ä¸‹æ²‰:${sinkDepthInCm}cm`;
        }
        
        // é‡ç½®å®éªŒ
        function resetExperiment() {
            elephantOnBoat = false;
            waterMarkAdded = false;
            stoneCount = 0;
            stonesOnBoat = [];
            isMarkingMode = false;
            successAnnounced = false;
            
            // é‡ç½®çŠ¶æ€
            currentWaterLevel = initialWaterLevel;
            currentBoatTop = initialBoatTop;
            currentSinkAmount = 0;
            waterMarkPosition = 0;
            
            // é‡ç½®DOMå…ƒç´ 
            elephantImg.style.opacity = '1';
            elephantImg.style.cursor = 'grab';
            elephantOnBoatImg.style.display = 'none';
            boatWaterMark.style.display = 'none';
            markingHint.style.display = 'none';
            boatContainer.style.cursor = 'default';
            
            markButton.disabled = true;
            markButton.textContent = 'æ ‡è®°æ°´ä½çº¿';
            removeElephantButton.disabled = true;
            
            // é‡ç½®èˆ¹å’Œæ°´é¢çš„ä½ç½®
            updateBoatAndWater();
            
            speak('å®éªŒé‡ç½®');
            
            stonesOnBoatContainer.innerHTML = '';
            
            const allStones = document.querySelectorAll('.stone');
            allStones.forEach(stone => {
                stone.style.opacity = '1';
                stone.style.cursor = 'grab';
            });
            
            updateCounters();
        }
        
        // äº‹ä»¶ç›‘å¬
        markButton.addEventListener('click', startMarkingWaterLevel);
        removeElephantButton.addEventListener('click', removeElephantFromBoat);
        resetButton.addEventListener('click', resetExperiment);
        
        // ä¸ºå¤§è±¡æ·»åŠ æ‹–åŠ¨äº‹ä»¶
        addDragEvents(elephantImg, 'elephant');
        
        // åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', function() {
            createStones();
            updateCounters();
            
            // ç¡®ä¿åˆå§‹çŠ¶æ€æ­£ç¡®
            updateBoatAndWater();
            
            // è¯­éŸ³æç¤ºåˆå§‹è¯´æ˜
            setTimeout(() => {
                speak('å°†å¤§è±¡æ‹–åˆ°èˆ¹ä¸Š');
            }, 1000);
            
            document.addEventListener('click', function initSpeech() {
                speechEnabled = true;
                document.removeEventListener('click', initSpeech);
            }, { once: true });
            
            // æ·»åŠ å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ
            const images = document.querySelectorAll('img');
            images.forEach(img => {
                img.addEventListener('error', function() {
                    if (this.alt.includes('èˆ¹')) {
                        this.style.display = 'none';
                        const fallback = document.createElement('div');
                        fallback.style.width = '100%';
                        fallback.style.height = '100%';
                        fallback.style.backgroundColor = '#8B4513';
                        fallback.style.borderRadius = '10px 10px 50px 50px';
                        fallback.style.position = 'relative';
                        fallback.style.boxShadow = '0 10px 20px rgba(0,0,0,0.3)';
                        fallback.innerHTML = '<div style="position:absolute;top:-30px;left:50%;transform:translateX(-50%);width:10px;height:60px;background-color:#8B4513;"></div><div style="position:absolute;top:-60px;left:50%;transform:translateX(-50%);width:60px;height:40px;background-color:#f0e68c;clip-path:polygon(50% 0%, 0% 100%, 100% 100%);"></div>';
                        this.parentNode.insertBefore(fallback, this);
                    } else if (this.alt.includes('å¤§è±¡')) {
                        this.style.display = 'none';
                        const fallback = document.createElement('div');
                        fallback.style.width = this.classList.contains('elephant-on-boat') ? '100px' : '150px';
                        fallback.style.height = this.classList.contains('elephant-on-boat') ? '80px' : '120px';
                        fallback.style.backgroundColor = '#aaa';
                        fallback.style.borderRadius = '40% 40% 20% 20%';
                        fallback.style.display = 'flex';
                        fallback.style.alignItems = 'center';
                        fallback.style.justifyContent = 'center';
                        fallback.style.fontSize = this.classList.contains('elephant-on-boat') ? '2rem' : '3rem';
                        fallback.textContent = 'ğŸ˜';
                        this.parentNode.insertBefore(fallback, this);
                    } else if (this.alt.includes('çŸ³å¤´')) {
                        this.style.display = 'none';
                        const fallback = document.createElement('div');
                        fallback.style.width = this.classList.contains('stone-on-boat') ? '50px' : '80px';
                        fallback.style.height = this.classList.contains('stone-on-boat') ? '50px' : '80px';
                        fallback.style.backgroundColor = '#777';
                        fallback.style.borderRadius = '50%';
                        fallback.style.display = 'flex';
                        fallback.style.alignItems = 'center';
                        fallback.style.justifyContent = 'center';
                        fallback.style.fontSize = '1.5rem';
                        fallback.textContent = 'ğŸª¨';
                        this.parentNode.insertBefore(fallback, this);
                    }
                });
            });
        });
    </script>
</body>
</html>